{"is_source_file": true, "format": "JavaScript", "description": "This file defines the CartController class for managing shopping cart operations in an e-commerce backend, including adding, updating, removing, and retrieving cart items. It imports models, validators, and storage services, and exports an instance of the controller.", "external_files": ["../models", "../utils/validators", "../services/storage"], "external_methods": ["models.Carts.getOrCreateByUser", "models.Products.byId", "models.Carts.addItem", "models.Carts.removeItem", "models.Carts.clear", "require('../services/storage').carts().update"], "published": ["CartController"], "classes": [{"name": "CartController", "description": "Controller class handling shopping cart operations for a user, including get, add, updateLine, removeLine, and clear methods."}], "methods": [{"name": "get", "description": "Retrieves the current user's cart, creating it if it doesn't exist."}, {"name": "add", "description": "Adds an item to the user's cart after validating input and ensuring the product exists and is active."}, {"name": "updateLine", "description": "Updates the quantity of a specific line item in the cart identified by productId, validating input and modifying the cart."}, {"name": "removeLine", "description": "Removes a specified line item from the user's cart."}, {"name": "clear", "description": "Clears all items from the user's cart."}], "calls": ["models.Carts.getOrCreateByUser", "models.Products.byId", "models.Carts.addItem", "require('../services/storage').carts().update", "models.Carts.removeItem", "models.Carts.clear"], "search-terms": ["CartController", "addItem", "updateLine", "removeLine", "clearCart", "cart.js"], "state": 2, "file_id": 20, "knowledge_revision": 47, "git_revision": "", "ctags": [{"_type": "tag", "name": "CartController", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^class CartController {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "cart", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    const cart = models.Carts.getOrCreateByUser(req.user.id);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "cart", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    const cart = models.Carts.getOrCreateByUser(req.user.id);$/", "language": "JavaScript", "kind": "field", "scope": "CartController", "scopeKind": "class"}, {"_type": "tag", "name": "cleared", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    const cleared = models.Carts.clear(req.user.id);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "exists", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    const exists = cart.items.find((i) => i.productId === lineId);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "exports", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^module.exports = new CartController();$/", "language": "JavaScript", "kind": "variable", "scope": "module", "scopeKind": "class"}, {"_type": "tag", "name": "lineId", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    const lineId = req.params.lineId;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "models", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^const models = require('..\\/models');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "prod", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    const prod = models.Products.byId(value.productId);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "req", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^  get(req, res) {$/", "language": "JavaScript", "kind": "field", "scope": "CartController", "scopeKind": "class"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    return res.json(cart);$/", "language": "JavaScript", "kind": "field", "scope": "CartController", "scopeKind": "class"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^  get(req, res) {$/", "language": "JavaScript", "kind": "field", "scope": "CartController", "scopeKind": "class"}, {"_type": "tag", "name": "saved", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    const saved = require('..\\/services\\/storage').carts().update(cart.id, { items: cart.items }/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    const updated = models.Carts.addItem(req.user.id, value.productId, value.qty);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "updated", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^    const updated = models.Carts.removeItem(req.user.id, lineId);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "v", "path": "/home/kavia/workspace/code-generation/unified-e-commerce-platform-186146-186156/backend/src/controllers/cart.js", "pattern": "/^const v = require('..\\/utils\\/validators');$/", "language": "JavaScript", "kind": "constant"}], "hash": "fc3dee0736ec9cfbcb41269fd9ce7bde", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/controllers/cart.js", "fields": [{"name": "const cart = models.Carts.getOrCreateByUser(req.user.id);", "scope": "CartController", "scopeKind": "class", "description": "unavailable"}, {"name": "module.exports = new CartController();", "scope": "module", "scopeKind": "class", "description": "unavailable"}, {"name": "get(req, res) {", "scope": "CartController", "scopeKind": "class", "description": "unavailable"}, {"name": "return res.json(cart);", "scope": "CartController", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"47": ""}]}